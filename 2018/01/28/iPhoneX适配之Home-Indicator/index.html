<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "a56087b5"
    });
  daovoice('update');
  </script>




  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="iPhoneX-Home-Indicator," />










<meta name="description" content="前言苹果一向特立独行，iPhoneX的横空出世更是令人咋舌，果粉自然惊喜，然而因为其刘海，iOS工程师却不得不进行苦逼的适配。关于iPhoneX的适配，网上自然非常之多，里面不乏优秀杰作。虽然也曾经独自承担了QQ阅读的iPhoneX适配工作，但是好多问题的解决之道都是相同的，本文不会再重复喋喋不休这些众所周知的适配问题，而是主要针对iPhoneX的Home-Indicator进行分析，一个似乎被遗">
<meta name="keywords" content="iPhoneX-Home-Indicator">
<meta property="og:type" content="article">
<meta property="og:title" content="iPhoneX适配之Home-Indicator">
<meta property="og:url" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/index.html">
<meta property="og:site_name" content="凌云的博客">
<meta property="og:description" content="前言苹果一向特立独行，iPhoneX的横空出世更是令人咋舌，果粉自然惊喜，然而因为其刘海，iOS工程师却不得不进行苦逼的适配。关于iPhoneX的适配，网上自然非常之多，里面不乏优秀杰作。虽然也曾经独自承担了QQ阅读的iPhoneX适配工作，但是好多问题的解决之道都是相同的，本文不会再重复喋喋不休这些众所周知的适配问题，而是主要针对iPhoneX的Home-Indicator进行分析，一个似乎被遗">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/03.png">
<meta property="og:image" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/04.png">
<meta property="og:image" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/05.png">
<meta property="og:image" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/06.png">
<meta property="og:image" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/08.png">
<meta property="og:image" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/07.png">
<meta property="og:updated_time" content="2018-02-09T14:40:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iPhoneX适配之Home-Indicator">
<meta name="twitter:description" content="前言苹果一向特立独行，iPhoneX的横空出世更是令人咋舌，果粉自然惊喜，然而因为其刘海，iOS工程师却不得不进行苦逼的适配。关于iPhoneX的适配，网上自然非常之多，里面不乏优秀杰作。虽然也曾经独自承担了QQ阅读的iPhoneX适配工作，但是好多问题的解决之道都是相同的，本文不会再重复喋喋不休这些众所周知的适配问题，而是主要针对iPhoneX的Home-Indicator进行分析，一个似乎被遗">
<meta name="twitter:image" content="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/03.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/"/>





  <title>iPhoneX适配之Home-Indicator | 凌云的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">凌云的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lingyun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/favicon.ico">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iPhoneX适配之Home-Indicator</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-28T23:43:41+08:00">
                2018-01-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,082
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>苹果一向特立独行，iPhoneX的横空出世更是令人咋舌，果粉自然惊喜，然而因为其刘海，iOS工程师却不得不进行苦逼的适配。关于iPhoneX的适配，网上自然非常之多，里面不乏优秀杰作。虽然也曾经独自承担了QQ阅读的iPhoneX适配工作，但是好多问题的解决之道都是相同的，本文不会再重复喋喋不休这些众所周知的适配问题，而是主要针对iPhoneX的Home-Indicator进行分析，一个似乎被遗忘到角落里的微不足道的适配点。</p>
<h2 id="问题引发点"><a href="#问题引发点" class="headerlink" title="问题引发点"></a>问题引发点</h2><p>对于大多数的App应用，或许完全没有这个必要进行Home-Indicator的适配，<strong>因为这个home条时时刻刻都在提醒用户改变原有的home键使用习惯，它的存在旨在替代原有的home键</strong>。<br>然而对于某些特殊的应用，比如阅读类的，视频类的，游戏类的，因为这些应用的核心功能都是处于一种沉浸式的环境中，此时Home-Indicator的呈现就显得格外刺目，尤其是在夜间模式下的那一道白光。<br>可以先体验一下（这里用的是模拟器，实际上真机上的体验要比模拟器更让人不舒服）</p>
<div style="float:left;border:solid 1px 000;margin:10px;"><img src="/2018/01/28/iPhoneX适配之Home-Indicator/03.png" width="300" height="590"></div>

<div style="float:left;border:solid 1px 000;margin:10px;"><img src="/2018/01/28/iPhoneX适配之Home-Indicator/04.png" width="300" height="590"></div><br><div style="float:none;clear:both;"><br></div>

<p>大概看了几款阅读软件，分别是掌阅，微信读书，百度阅读，书旗小说，基本上都没有针对这个做适配，不知道是不是iPhoneX的市场小导致。不过目前看来，<code>Home-Indicator</code>的适配还是很有必要的，接下来以QQ阅读为例来分析下适配过程：</p>
<h2 id="白天模式初步适配"><a href="#白天模式初步适配" class="headerlink" title="白天模式初步适配"></a>白天模式初步适配</h2><p>好吧，根据官方的指示，开始适配<br>先看一下<code>UIViewController</code>的头文件，iOS 11 增加了<code>UIViewController</code>的一个 <code>UIHomeIndicatorAutoHidden</code>分类来控制home键的自动隐藏</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIViewController</span> (<span class="title">UIHomeIndicatorAutoHidden</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Override to return a child view controller or nil. If non-nil, that view controller's home indicator auto-hiding will be used. If nil, self is used. Whenever the return value changes, -setNeedsHomeIndicatorAutoHiddenUpdate should be called.</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIViewController</span> *)childViewControllerForHomeIndicatorAutoHidden API_AVAILABLE(ios(<span class="number">11.0</span>)) API_UNAVAILABLE(watchos, tvos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Controls the application's preferred home indicator auto-hiding when this view controller is shown.</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)prefersHomeIndicatorAutoHidden API_AVAILABLE(ios(<span class="number">11.0</span>)) API_UNAVAILABLE(watchos, tvos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This should be called whenever the return values for the view controller's home indicator auto-hiding have changed.</span></span><br><span class="line">- (<span class="keyword">void</span>)setNeedsUpdateOfHomeIndicatorAutoHidden API_AVAILABLE(ios(<span class="number">11.0</span>)) API_UNAVAILABLE(watchos, tvos);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>实际上可以发现HomeIndicator的控制和状态栏的控制很相似，那么按照上述API开始适配：</p>
<blockquote>
<ul>
<li>1、在需要隐藏的VC里面覆盖函数prefersHomeIndicatorAutoHidden</li>
</ul>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)prefersHomeIndicatorAutoHidden&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>2、在合适的地方调用<code>setNeedsUpdateOfHomeIndicatorAutoHidden</code></li>
</ul>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (@available(iOS <span class="number">11.0</span>, *)) &#123;</span><br><span class="line">    [<span class="keyword">self</span> setNeedsUpdateOfHomeIndicatorAutoHidden];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>够了吗？貌似上述方法还不够，没有生效，原因是：<br><strong>重写控制器的此方法的这种情况只适用于此控制器没有父控制器的情形，而绝大部分的应用都是以<code>UITabBarController</code>或<code>UINavigationController</code>作为window的根控制器,<code>UIViewController</code>来展示内容，这时还需要重写根控制器的<code>childViewControllerForHomeIndicatorAutoHidden</code>方法</strong><br>。<br><strong>这里需要注意的是：这里的根控制器并不一定就是<code>UINavigationController</code>或者<code>UITabBarController</code>，可能是接入第三方的，也有可能是自定义的，例如QQ阅读的根控制器<code>XXXViewController</code>就是自定义的</strong></p>
<p>以下是对根控制器<code>XXXViewController</code>的<code>childViewControllerForHomeIndicatorAutoHidden</code>的重写<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIViewController</span>*)childViewControllerForHomeIndicatorAutoHidden</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">id</span>&lt;<span class="built_in">UIApplicationDelegate</span>&gt; * appDelegate = <span class="built_in">UIApplication</span> sharedApplication].delegate</span><br><span class="line">    <span class="built_in">UIViewController</span> *topViewController = appDelegate.viewController.topViewController;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// XXXViewController是我们想控制Home-Indicator的VC</span></span><br><span class="line">    <span class="keyword">if</span> ([topViewController isKindOfClass:[XXXViewController <span class="keyword">class</span>]])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> topViewController;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>经过上述适配步骤之后，白天模式下进入阅读页，<code>Home-Indicator</code>将会显示，如果页面无点击操作，大概1s左右，<code>Home-Indicator</code>将会自动隐藏。但是阅读页一旦发生点击操作，<code>Home-Indicator</code>还是会再次显示，不过很快又会自动消失。</p>
<p>如果适配到此就结束了，这篇文章确实没有写的必要了，然而适配QQ阅读<code>Home-Indicator</code>遇到的坑才真正开始…</p>
<h2 id="阅读页切换夜间模式"><a href="#阅读页切换夜间模式" class="headerlink" title="阅读页切换夜间模式"></a>阅读页切换夜间模式</h2><p>在我的理解来看，正常的夜间模式，应该是专门的一套皮肤来做，省心省力，如果您的项目工程就是这样实现的，那么也基本上不会遇到我碰到的坑。但是有的项目工程可能由于历史原因，并没有这么做，而是采取了其它方式：<strong> 在当前的Window的上面加一个不能响应事件的Window，并对其rootVC的view的透明度进行设置，故而造成一定的夜间视觉感</strong> ，这种方式可能工作量小一些，但是却可能引发各种各样的问题，比如之前影响到页面的跳转，又比如这次它就影响到了<code>Home-Indicator</code>的适配。</p>
<p>这种夜间模式的实现如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)enableNightMode</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIWindow</span> *window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>,<span class="number">0</span>,kScreenWidth, kScreenHeight)];</span><br><span class="line">    window.userInteractionEnabled = <span class="literal">NO</span>;</span><br><span class="line">    window.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    window.windowLevel = XXXLevelGlobalNightMode;</span><br><span class="line">    XXXNightModeMaskViewController *vc = [[XXXNightModeMaskViewController alloc] init];</span><br><span class="line">    vc.view.backgroundColor = [[<span class="built_in">UIColor</span> blackColor] colorWithAlphaComponent:<span class="number">0.35</span>];</span><br><span class="line">    window.rootViewController = vc;</span><br><span class="line">    [window makeKeyAndVisible];</span><br><span class="line">    <span class="keyword">self</span>.nightModeWindow = window;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正是由于上面覆盖了一个window，导致每次在阅读页切换夜间模式的时候调用方法<code>childViewControllerForHomeIndicatorAutoHidden</code>时，每次都调到了<code>XXXNightModeMaskViewController</code>中，而不是前文提到的正常Window的根控制器中，这样我们之前设置的代码就无法被调用，进而导致控制失效。</p>
<p><strong> 解决方案就是重写<code>XXXNightModeMaskViewController</code>的<code>childViewControllerForHomeIndicatorAutoHidden</code>方法</strong></p>
<p>以下是对XXXNightModeMaskViewController的方法<code>childViewControllerForHomeIndicatorAutoHidden</code>的重写<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIViewController</span>*)childViewControllerForHomeIndicatorAutoHidden</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 找到正常的window</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到topViewController</span></span><br><span class="line">    <span class="built_in">UIViewController</span> *topViewController = window.rootViewController.topViewController;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 把想控制的VC放到这里进行判断，当然也可以放到一个白名单集合里</span></span><br><span class="line">    <span class="keyword">if</span> ([topViewController isKindOfClass:[XXXViewController <span class="keyword">class</span>]])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> topViewController;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="夜间模式下进入阅读页"><a href="#夜间模式下进入阅读页" class="headerlink" title="夜间模式下进入阅读页"></a>夜间模式下进入阅读页</h2><p>问题解决完了吗？还没有，因为在夜间模式下，从阅读页外面（比如书架）直接进入阅读页，<code>Home-Indicator</code>还是无法消失。</p>
<blockquote>
<ul>
<li><p>1、先来看下之前的阅读页切换夜间模式的调用堆栈:<br><img src="/2018/01/28/iPhoneX适配之Home-Indicator/05.png" width="75%"><br>如果在阅读页切换夜间模式，则会触发<code>[UIWindow makeKeyAndVisiable]</code>，进而触发<code>childViewControllerForHomeIndicatorAutoHidden</code>。但是由于其不能响应任何事件，导致这是它唯一能触发<code>childViewControllerForHomeIndicatorAutoHidden</code>的机会。</p>
</li>
<li><p>2、再看下白天模式下从书架直接进入阅读页的堆栈：<br><img src="/2018/01/28/iPhoneX适配之Home-Indicator/06.png" width="65%"><br>目测<code>[UINavigationController pushViewController:animated:]</code>也可以触发<code>childViewControllerForHomeIndicatorAutoHidden</code>。</p>
</li>
<li><p>3、在夜间模式下，<code>[UINavigationController pushViewController:animated:]</code>也会被调用，然而却无法触发根控制器中<code>childViewControllerForHomeIndicatorAutoHidden</code>方法的调用，导致再次失效，猜想可能和keyWindow有关系，但是很遗憾，未能找到原因（希望有高手指点），不过这并不意味着找不到解决方案：在我们想控制的<code>XXXViewController</code>中，重新触发一下夜间模式就可以了</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">if</span>(IS_IPHONEX &amp;&amp; !_isDayMode)&#123;</span><br><span class="line">        [ThemeMgr enableNightMode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>来看下适配后的效果图</p>
<div style="float:left;border:solid 1px 000;margin:10px;"><img src="/2018/01/28/iPhoneX适配之Home-Indicator/08.png" width="300" height="590"></div>

<p><div style="float:left;border:solid 1px 000;margin:10px;"><img src="/2018/01/28/iPhoneX适配之Home-Indicator/07.png" width="300" height="590"></div></p>
<p><div style="float:none;clear:both;"><br></div></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Home-Indicator的适配如果这样循序渐进地进行，基本上时间花销不会太久，只可惜一开始我就掉到了夜间模式的陷进里，并且未想到<code>Home-Indicator</code>的适配会和这种夜间模式有什么关系，导致我折腾了很久。我一度认为这个适配可能就和应用内评分一样，客户端的掌控是很弱的，并且对苹果的官方意见深信不疑：</p>
<blockquote>
<ul>
<li>The indicator will automatically adjust itself depending on what’s below it, and it’s not something you can directly control.  As described in Designing for iPhone X, you generally don’t want to do anything in your app specific to the home indicator</li>
</ul>
</blockquote>
<p>不过实际上来看，虽然现在已经适配完了，客户端的掌控力还是很弱，目前还是有一定的缺陷：<strong>那就是只要在阅读页内发生touch行为，<code>Home-Indicator</code>就会进行短暂的出现，之后会缓慢消失</strong>，这应该是苹果内部的实现机制导致的，我们估计无能为力。我大概看了下适配过<code>Home-Indicator</code>的视频类App和游戏类App，基本上都存在这个问题。幸运的是，手势不会有太大的影响，QQ阅读页的手势翻页基本上不会影响到<code>Home-Indicator</code>出现，猜想这可能和手势的响应优先级有关。<br>最后希望以后能有更好的完善。</p>

      
    </div>
    
    
    

    
      <div>
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束 感谢您的阅读-------------</div>
    
</div>

      <div>
    

    
      <div>
        
<div class="my_post_copyright">
  <script src="//s0.pstatp.com/cdn/expire-1-M/clipboard.js/1.5.10/clipboard.min.js"></script>
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://s1.pstatp.com/cdn/expire-1-M/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2018/01/28/iPhoneX适配之Home-Indicator/">iPhoneX适配之Home-Indicator</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 lingyun 的个人博客">lingyun</a></p>
  <p><span>发布时间:</span>2018年01月28日 - 23:01</p>
  <p><span>最后更新:</span>2018年02月09日 - 22:02</p>
  <p><span>原始链接:</span><a href="/2018/01/28/iPhoneX适配之Home-Indicator/" title="iPhoneX适配之Home-Indicator">https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
  });
    });  
</script>


      <div>
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="lingyun 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="lingyun 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        
<div class="my_post_copyright">
  <script src="//s0.pstatp.com/cdn/expire-1-M/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://s1.pstatp.com/cdn/expire-1-M/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2018/01/28/iPhoneX适配之Home-Indicator/">iPhoneX适配之Home-Indicator</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 lingyun 的个人博客">lingyun</a></p>
  <p><span>发布时间:</span>2018年01月28日 - 23:01</p>
  <p><span>最后更新:</span>2018年02月09日 - 22:02</p>
  <p><span>原始链接:</span><a href="/2018/01/28/iPhoneX适配之Home-Indicator/" title="iPhoneX适配之Home-Indicator">https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://tsuijunxi.github.io/2018/01/28/iPhoneX适配之Home-Indicator/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
  });
    });  
</script>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iPhoneX-Home-Indicator/" rel="tag"># iPhoneX-Home-Indicator</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/24/iOS消息转发的正确Hook姿势/" rel="next" title="JSPatch VS Aspects">
                <i class="fa fa-chevron-left"></i> JSPatch VS Aspects
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/30/iOS启动优化/" rel="prev" title="iOS启动优化">
                iOS启动优化 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/favicon.ico"
                alt="lingyun" />
            
              <p class="site-author-name" itemprop="name">lingyun</p>
              <p class="site-description motion-element" itemprop="description">Stay Hungry, Stay Foolish</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#问题引发点"><span class="nav-number">2.</span> <span class="nav-text">问题引发点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#白天模式初步适配"><span class="nav-number">3.</span> <span class="nav-text">白天模式初步适配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#阅读页切换夜间模式"><span class="nav-number">4.</span> <span class="nav-text">阅读页切换夜间模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#夜间模式下进入阅读页"><span class="nav-number">5.</span> <span class="nav-text">夜间模式下进入阅读页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#效果"><span class="nav-number">6.</span> <span class="nav-text">效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lingyun</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">133.0k</span>

  <div class="powered-by">
    <i class="fa fa-user-md"></i>
    <span id="busuanzi_container_site_pv">
      本站总访问量<span id="busuanzi_value_site_pv"></span>次
    </span>|
    <i class="fa fa-eye-md"></i>
    <span id="busuanzi_container_site_uv">
      本站访客数:<span id="busuanzi_value_site_uv"></span>人
    </span>

  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="/js/src/md5.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '3b98a5ec68bfccc21c29',
          clientSecret: '4c30086ddf0fdf77d050830b540bcffd3054c1b0',
          repo: 'tsuijunxi.github.io',
          owner: 'tsuijunxi',
          admin: ['tsuijunxi'], 
          id: md5(location.pathname),
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>


  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
